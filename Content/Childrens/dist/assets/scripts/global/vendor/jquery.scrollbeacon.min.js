!function(t,e){"use strict";var o="scrollbeacon",i=o+"_elementid",n="appear."+o,r="disappear."+o,s="positionchange."+o,l="topreached."+o,a="bottomreached."+o,h=[n,r,s,l,a],c=t.map(h,function(t){return t.split(".").shift()}),p=t[o]={every:34,VIEW_ABOVE:-2,VIEW_BELOW:-1,VIEW_OUT:0,VIEW_CLIP_BOTTOM:1,VIEW_INTERSECT:2,VIEW_CLIP_TOP:4,VIEW_OVERLAP:7},u={parent:e,offset:null,scrolltick:null,appear:null,disappear:null,positionchange:null,topreached:null,bottomreached:null};t.fn[o]=function(){var e,i;"string"==typeof arguments[0]?(e=arguments[0],i=t.extend({},u,arguments[1]||{}),Array.prototype.slice.call(arguments,2)):(e="init",i=t.extend({},u,arguments[0]||{}),Array.prototype.slice.call(arguments,1));var n=t(i.parent);if(0===n.length||n.length>1)throw new Error("parent has to be a single object.");if(n[0]===document)throw new Error("parent should not be `document.` Choose `window` or other block element instaed.");var r=n.data("scroller");void 0===r&&(r=new f(n[0])),r.setScrollTick(i.scrolltick);var s={init:function(e,n){var s=t(n).data(o);return s?(_(n,i),i.offset?s.setOffset(i.offset):s.refresh()):r.add(n,i),this},refresh:function(e,n){var s=t(n).data(o);return s?(i.offset&&s.setOffset(i.offset),s.refresh()):r.add(n,i),this},destroy:function(e,i){var n=t(i).data(o);return n&&n.destroy(),this},stop:function(e,i){var n=t(i).data(o);return n&&n.stop(),this}};return this.each(s[e])};var f=function(e){var o=t(e);this.elm=e,this.targets=[],this.scrolltick=null,this.last_scroll=b(),this.last_top=o.scrollTop(),this.handler_tailing=!1,this.tailing_function=t.proxy(this._tail,this),this.tailing_event=null,this.event_subscription={},this.proxy_onscroll=t.proxy(this._onscroll,this),o.data("scroller",this)};f.prototype._hookEventBinding=function(e,o,i,n){var r=t(e),s=d(r),l=r.data("events");n?i?this.event_subscription[[s,"/",o].join("")]=!0:delete this.event_subscription[[s,"/",o].join("")]:i?this.event_subscription[[s,"/",o].join("")]=!0:void 0!==l&&l[o]||delete this.event_subscription[[s,"/",o].join("")],t.map(this.event_subscription,function(){return 1}).length?void 0!==l&&l.scroll||t(this.elm).on("scroll touchmove",this.proxy_onscroll):l&&l.scroll&&t(this.elm).off("scroll touchmove",this.proxy_onscroll)},f.prototype.setScrollTick=function(t){return"function"==typeof t&&(this.scrolltick=t,this._hookEventBinding(this.elm,"scrolltick",!0,!0)),this},f.prototype.removeScrollTick=function(){return this.scrolltick=null,this._hookEventBinding(this.elm,"scrolltick",!1,!0),this},f.prototype.add=function(t,e){return this.targets.push(new v(this,t,e.offset)),_(t,e),this},f.prototype.remove=function(e){var o=!1,i=t.inArray(e,this.targets);return i>-1&&(o=!0,this.targets.splice(i,1)),o},f.prototype.refresh=function(){return t.each(this.targets,function(t,e){e.refresh()}),this},f.prototype._tail=function(){var t=this.tailing_event;this.handler_tailing=!1,this.tailing_event=null,this._scrollimpl(t,!0)},f.prototype._onscroll=function(t){var e=b();if(e-this.last_scroll>p.every)return this.last_scroll=e,void this._scrollimpl(t);this.handler_tailing&&clearTimeout(this.handler_tailing),this.handler_tailing=setTimeout(this.tailing_function,1.25*p.every),this.tailing_event=t},f.prototype._scrollimpl=function(e,i){var n,r=t(this.elm).scrollTop(),s=r-this.last_top;i&&0===s||(n=e[o]={direction:s>=0?"down":"up",delta:s},this.last_top=r,this.scrolltick&&this.scrolltick(e),t.each(t.map(this.targets,k(this.elm,s)),w(n)))};var v=function(e,i,n){this.elm=i,this.scroller=e,this.setOffset(n),t(i).data(o,this)};v.prototype.destroy=function(){var e=t(this.elm).data();this.stop(),this.scroller.remove(this),this.elm=null,this.scroller=null,delete e[o],delete e[i]},v.prototype.stop=function(){var e=t(this.elm);return t.each(h,function(t,o){e.off(o)}),this},v.prototype.refresh=function(){var t=y(this.scroller.elm,this.elm,this.offset_t,this.offset_b),e=E(this.scroller.elm,t.top,t.bottom);return this.top=t.top,this.bottom=t.bottom,this.position=e,this.in_view=e>0,this},v.prototype.setOffset=function(t){var e=m(t),o=y(this.scroller.elm,this.elm,e.top,e.bottom),i=E(this.scroller.elm,o.top,o.bottom);return this.offset_t=e.top,this.offset_b=e.bottom,this.top=o.top,this.bottom=o.bottom,this.position=i,this.in_view=i>0,this};var d=function(t){var e=t.data(i);return e||(e="se_"+b(),t.data(i,e)),e},_=function(e,i){var n=t(e);t.each(c,function(t){"function"==typeof i[this]&&n.on([this,o].join("."),i[this])})},m=function(t){var e,o,i=typeof t;return"number"===i?e=o=t:"string"===i?e=o=g(t):"undefined"===i||"function"===i?e=o=0:"boolean"===i?e=o=t?1:0:null===t?e=o=0:"[object Array]"===Object.prototype.toString.apply(t)?(e=g(t[0]),o=g(t[1])):(e=g(t.top),o=g(t.bottom)),{top:e,bottom:o}},g=function(t,e,o){var i;return o=o||10,e=e||0,i=parseInt(t,o),isNaN(i)&&(i=e),i},y=function(o,i,n,r){var s,l=0,a=t(i);return o!==e&&(l=t(o).offset().top),(s={top:Math.round(a.offset().top-l+n)}).bottom=s.top+Math.round(a.outerHeight(!0)+r),s},b=function(){return(new Date).valueOf()},E=function(e,o,i){var n=0,r=t(e),s=r.scrollTop(),l=s+r.height();return i<=s?n=-2:l<=o?n=-1:o<=s?l<=i?n=7:i<=l&&(n=4):s<=o&&(i<=l?n=2:i<=i&&(n=1)),n},w=function(e){return function(i,h){var c,p,u=t.Event(s),f=h.target,v=t(f.elm),d=t.extend({},e);d.position=f.position,u[o]=d,v.triggerHandler(u),h.event_tr&&((p=t.Event(l))[o]=d,v.triggerHandler(p)),h.event_br&&((p=t.Event(a))[o]=d,v.triggerHandler(p)),h.event_ad&&((c=f.in_view?t.Event(n):t.Event(r))[o]=d,v.triggerHandler(c))}},k=function(t,e){return function(o,i){var n,r=E(t,o.top,o.bottom),s=o.position;return s!==r&&(n={target:o},e>0?(-1!==s&&1!==s&&2!==s||-2!==r&&4!==r&&7!==r||(n.event_tr=!0),1<r&&r<7&&(-1===s||1===s||7===s)&&(n.event_br=!0)):e<0&&(-1!==r&&1!==r&&2!==r||-2!==s&&4!==s&&7!==s||(n.event_tr=!0),1<s&&s<7&&(-1===r||1===r||7===r)&&(n.event_br=!0)),o.position=r,r>0?o.in_view||(o.in_view=!0,n.event_ad=!0):o.in_view&&(o.in_view=!1,n.event_ad=!0)),n}};t.each(h,function(e,o){var i=o.split("."),n=i.shift(),r=i.join(".");t.event.special[n]={add:function(e){var o=t(this).data(r);o&&o.scroller._hookEventBinding(o,n,!0)},remove:function(e){var o=t(this).data(r);o&&o.scroller._hookEventBinding(o,n,!1)}}})}(jQuery,window);